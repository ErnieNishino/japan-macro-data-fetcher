import requests
import pandas as pd
import io
import sys

# ==========================================
# 1. é…ç½®åŒºåŸŸ
# ==========================================
# âš ï¸ æ³¨æ„ï¼šè¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ e-Stat APP ID
# ç”³è¯·åœ°å€ï¼šhttps://www.e-stat.go.jp/api/
APP_ID = 'YOUR_APP_ID_HERE' 

# å®šä¹‰æœç´¢ç›®æ ‡
TARGETS = [
    {
        "key": "2_Consumption_å¼•æ“",
        "search_word": "å®¶è¨ˆèª¿æŸ» äºŒäººä»¥ä¸Šã®ä¸–å¸¯ æœˆæ¬¡",
        "desc": "æ¨èæ‰¾ã€ç”¨é€”åˆ†é¡ï¼ˆç·æ•°ï¼‰ã€‘(å…³æ³¨æœ€æ–°æ—¥æœŸ)",
        "recommend": "ç·æ•°"
    },
    {
        "key": "3_CPI_ä¼ åŠ¨",
        "search_word": "æ¶ˆè²»è€…ç‰©ä¾¡æŒ‡æ•°",
        "desc": "æ¨èæ‰¾ã€ä¸­åˆ†é¡ã€‘æˆ–ã€åŸºæœ¬åˆ†é¡ã€‘(å…³æ³¨æœ€æ–°æ—¥æœŸ)",
        "recommend": "ä¸­åˆ†é¡"
    },
]

# ... (ä»¥ä¸‹å‡½æ•°ä¿æŒä¸å˜ï¼Œä¸éœ€è¦ä¿®æ”¹) ...
# ä¸ºäº†èŠ‚çœç¯‡å¹…ï¼Œè¿™é‡Œçœç•¥äº†ä¸­é—´çš„å‡½æ•°ä»£ç ï¼Œ
# å®é™…ä¿å­˜æ–‡ä»¶æ—¶è¯·ä¿ç•™ä½ åŸæœ‰çš„å®Œæ•´ search_and_select å’Œ fetch_csv_direct å‡½æ•°
# ... (è¯·æŠŠåˆšæ‰å®Œæ•´çš„ä»£ç æ‹·è¿›æ¥ï¼Œåªæ”¹ APP_ID é‚£ä¸€è¡Œ) ...

# ==========================================
# ä¸»ç¨‹åº
# ==========================================
if __name__ == "__main__":
    if APP_ID == 'YOUR_APP_ID_HERE':
        print("âŒ é”™è¯¯ï¼šè¯·å…ˆåœ¨ä»£ç ä¸­å¡«å…¥ä½ çš„ e-Stat APP IDï¼")
        sys.exit(1)

    print("ğŸš€ å¯åŠ¨æ—¥æœ¬å®è§‚æ•°æ®æŠ“å–åŠ©æ‰‹ (äº¤äº’é€‰æ‹© + CSVç›´è¿ç‰ˆ)\n")

    for target in TARGETS:
        # 1. æœç´¢å¹¶è®©æ‚¨é€‰æ‹©
        sid = search_and_select(target)

        # 2. å¦‚æœé€‰äº†ï¼Œå°±ä¸‹è½½
        if sid:
            fetch_csv_direct(target['key'], sid)
        else:
            print(f"   âš ï¸ è·³è¿‡ {target['key']}")
            
    print("\nğŸ’¡ åˆ«å¿˜äº†ã€æ¯æœˆå‹¤åŠ´çµ±è¨ˆèª¿æŸ»ã€‘éœ€è¦æ‰‹åŠ¨ä¸‹è½½ï¼š")
    print("https://www.e-stat.go.jp/stat-search/files?page=1&layout=datalist&toukei=00450071&tstat=000001011791&cycle=0&tclass1=000001218880&tclass2val=0")
    print("\nğŸ æ‰€æœ‰ä»»åŠ¡ç»“æŸã€‚")